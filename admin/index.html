<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcement Manager</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        h1 { border-bottom: 2px solid #eee; padding-bottom: 0.5rem; }
        .form-group { margin-bottom: 1rem; display: flex; gap: 0.5rem; }
        input[type="text"] { flex: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        button.delete { background: #dc3545; }
        button.delete:hover { background: #a71d2a; }
        button.activate { background: #28a745; }
        button.activate:hover { background: #1e7e34; }
        button.deactivate { background: #ffc107; color: black; }
        button.deactivate:hover { background: #d39e00; }
        
        .list { list-style: none; padding: 0; }
        .item { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border: 1px solid #eee; margin-bottom: 0.5rem; border-radius: 4px; }
        .item.active { border-left: 5px solid #28a745; background-color: #f9fff9; }
        .item-content { flex: 1; margin-right: 1rem; }
        .item-actions { display: flex; gap: 0.5rem; }
        .status { font-size: 0.8rem; text-transform: uppercase; font-weight: bold; margin-right: 0.5rem; }
        .status.active { color: #28a745; }
        .status.draft { color: #6c757d; }
    </style>
</head>
<body>
    <h1>Announcement Manager</h1>
    
    <div class="form-group">
        <input type="text" id="newContent" placeholder="Enter new announcement text..." />
        <button id="addBtn">Add Announcement</button>
    </div>

    <ul id="list" class="list"></ul>

    <script>
        const API_URL = '/api/announcements';
        const listEl = document.getElementById('list');
        const inputEl = document.getElementById('newContent');
        const addBtn = document.getElementById('addBtn');

        async function fetchAnnouncements() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                render(data);
            } catch (err) {
                console.error('Error fetching announcements:', err);
                listEl.innerHTML = '<p style="color:red">Error loading announcements.</p>';
            }
        }

        function render(items) {
            listEl.innerHTML = '';
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = `item ${item.isActive ? 'active' : ''}`;
                
                const statusHtml = item.isActive 
                    ? '<span class="status active">Active</span>' 
                    : '<span class="status draft">Draft</span>';

                const toggleBtnText = item.isActive ? 'Deactivate' : 'Approve/Activate';
                const toggleBtnClass = item.isActive ? 'deactivate' : 'activate';

                li.innerHTML = `
                    <div class="item-content">
                        ${statusHtml}
                        <span>${escapeHtml(item.content)}</span>
                    </div>
                    <div class="item-actions">
                        <button class="${toggleBtnClass}" onclick="toggleStatus('${item.id}', ${!item.isActive})">${toggleBtnText}</button>
                        <button class="delete" onclick="deleteItem('${item.id}')">Delete</button>
                    </div>
                `;
                listEl.appendChild(li);
            });
        }

        async function addAnnouncement() {
            const content = inputEl.value.trim();
            if (!content) return;

            addBtn.disabled = true;
            try {
                await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content })
                });
                inputEl.value = '';
                fetchAnnouncements();
            } catch (err) {
                alert('Failed to add announcement');
            } finally {
                addBtn.disabled = false;
            }
        }

        async function toggleStatus(id, isActive) {
            try {
                await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ isActive })
                });
                fetchAnnouncements();
            } catch (err) {
                alert('Failed to update status');
            }
        }

        async function deleteItem(id) {
            if (!confirm('Are you sure you want to delete this announcement?')) return;
            try {
                await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                fetchAnnouncements();
            } catch (err) {
                alert('Failed to delete');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        addBtn.addEventListener('click', addAnnouncement);
        fetchAnnouncements();
    </script>
</body>
</html>
